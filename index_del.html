<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Football Player Comparison Model</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Chart.js for visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <style>
        /* Custom styles for better aesthetics */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        /* Ensure chart containers have a defined height */
        #scatterPlotContainer, #radarChartContainer {
            height: 500px;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-2">Player Comparison Model</h1>
        <p class="text-gray-600 mb-6">Compare players based on their calculated Attack and Defence Indices. Input player names separated by commas (e.g., L. Messi, Cristiano Ronaldo, V. van Dijk).</p>

        <!-- Player Input Card -->
        <div class="card bg-white p-6 rounded-xl mb-8">
            <label for="playerInput" class="block text-lg font-medium text-gray-700 mb-2">Players to Compare</label>
            <input type="text" id="playerInput" value="L. Messi, V. van Dijk, S. Ramos" 
                   placeholder="Enter player names separated by commas"
                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150">
            <button onclick="comparePlayers()" 
                    class="mt-4 w-full md:w-auto px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-150 transform hover:scale-[1.01]">
                Run Comparison
            </button>
        </div>

        <!-- Comparison Output -->
        <div id="resultsArea" class="space-y-8">
            
            <!-- Scatter Plot -->
            <div class="card bg-white p-6 rounded-xl">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Attack vs. Defence Index Scatter Plot</h2>
                <div id="scatterPlotContainer" class="relative">
                    <canvas id="scatterChart"></canvas>
                </div>
                <p class="mt-4 text-sm text-gray-500">
                    *The position indicates the player profile: Top-Right (All-Rounder), Bottom-Right (Attacker), Top-Left (Defender).
                </p>
            </div>

            <!-- Radar Chart (Raw Stat Comparison) -->
            <div class="card bg-white p-6 rounded-xl">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Raw Stat Comparison (First two selected players)</h2>
                <div id="radarChartContainer" class="relative">
                    <canvas id="radarChart"></canvas>
                </div>
                <p class="mt-4 text-sm text-gray-500">
                    *This chart compares the raw 0-100 scores for the 16 attributes used to calculate the Attack and Defence Indices.
                </p>
            </div>

            <!-- Data Table -->
             <div class="card bg-white p-6 rounded-xl">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Index Scores</h2>
                <div class="overflow-x-auto">
                    <table id="dataTable" class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Attack Index</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Defence Index</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Data will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- I. Foundation & Data Setup ---

        // These feature lists must match the properties in the PLAYER_DATA array below
        const ATTACK_FEATURES = [
            'finishing', 'volleys', 'long_shots', 'positioning', 'penalties', 
            'dribbling', 'ball_control', 'vision', 'crossing', 'short_passing' 
        ];

        const DEFENSE_FEATURES = [
            'marking', 'standing_tackle', 'sliding_tackle', 'interceptions', 
            'aggression', 'heading_accuracy'
        ];
        
        const ALL_FEATURES = [...ATTACK_FEATURES, ...DEFENSE_FEATURES];

        // Mock Dataset with all 16 raw stats and the calculated indices (0-1)
        const PLAYER_DATA = [
            { name: "L. Messi", Attack_Index: 0.98, Defense_Index: 0.38, 
              finishing: 95, volleys: 85, long_shots: 94, positioning: 95, penalties: 75, dribbling: 97, ball_control: 96, vision: 94, crossing: 88, short_passing: 90, 
              marking: 33, standing_tackle: 36, sliding_tackle: 28, interceptions: 40, aggression: 48, heading_accuracy: 70 },

            { name: "Cristiano Ronaldo", Attack_Index: 0.94, Defense_Index: 0.45, 
              finishing: 92, volleys: 86, long_shots: 88, positioning: 90, penalties: 85, dribbling: 88, ball_control: 89, vision: 85, crossing: 84, short_passing: 82, 
              marking: 40, standing_tackle: 45, sliding_tackle: 40, interceptions: 50, aggression: 78, heading_accuracy: 90 },

            { name: "V. van Dijk", Attack_Index: 0.63, Defense_Index: 0.92, 
              finishing: 40, volleys: 50, long_shots: 60, positioning: 65, penalties: 70, dribbling: 70, ball_control: 75, vision: 65, crossing: 55, short_passing: 80, 
              marking: 95, standing_tackle: 92, sliding_tackle: 88, interceptions: 90, aggression: 82, heading_accuracy: 94 },

            { name: "S. Ramos", Attack_Index: 0.75, Defense_Index: 0.96, 
              finishing: 65, volleys: 60, long_shots: 70, positioning: 75, penalties: 80, dribbling: 75, ball_control: 80, vision: 70, crossing: 70, short_passing: 85, 
              marking: 90, standing_tackle: 90, sliding_tackle: 90, interceptions: 90, aggression: 90, heading_accuracy: 90 },

            { name: "K. De Bruyne", Attack_Index: 0.90, Defense_Index: 0.65, 
              finishing: 85, volleys: 80, long_shots: 91, positioning: 88, penalties: 80, dribbling: 88, ball_control: 88, vision: 92, crossing: 95, short_passing: 93, 
              marking: 55, standing_tackle: 60, sliding_tackle: 50, interceptions: 65, aggression: 68, heading_accuracy: 70 },

            { name: "N. KantÃ©", Attack_Index: 0.55, Defense_Index: 0.90, 
              finishing: 60, volleys: 55, long_shots: 50, positioning: 70, penalties: 65, dribbling: 80, ball_control: 85, vision: 75, crossing: 70, short_passing: 85, 
              marking: 92, standing_tackle: 90, sliding_tackle: 88, interceptions: 92, aggression: 92, heading_accuracy: 70 },

            { name: "T. Kroos", Attack_Index: 0.85, Defense_Index: 0.70, 
              finishing: 70, volleys: 75, long_shots: 80, positioning: 78, penalties: 70, dribbling: 85, ball_control: 87, vision: 88, crossing: 88, short_passing: 93, 
              marking: 60, standing_tackle: 75, sliding_tackle: 70, interceptions: 80, aggression: 65, heading_accuracy: 55 },

            { name: "G. Chiellini", Attack_Index: 0.40, Defense_Index: 0.95, 
              finishing: 35, volleys: 40, long_shots: 30, positioning: 50, penalties: 45, dribbling: 50, ball_control: 60, vision: 55, crossing: 50, short_passing: 70, 
              marking: 96, standing_tackle: 95, sliding_tackle: 92, interceptions: 94, aggression: 94, heading_accuracy: 89 }
        ];

        // Store chart instances globally to destroy/re-render them
        let scatterChartInstance = null;
        let radarChartInstance = null;

        // --- II. Core Logic & Filtering ---

        const playerInput = document.getElementById('playerInput');

        /**
         * Filters the main data based on the player names entered by the user.
         * @returns {Array} List of selected player objects.
         */
        function getSelectedPlayerData() {
            const inputNames = playerInput.value.split(',')
                .map(name => name.trim())
                .filter(name => name.length > 0);

            // Filter data to include only players whose names match the input
            const selectedPlayers = PLAYER_DATA.filter(player => 
                inputNames.some(inputName => player.name.toLowerCase() === inputName.toLowerCase())
            );

            if (selectedPlayers.length === 0 && inputNames.length > 0) {
                 console.warn("No matching players found for the input.");
            }
            return selectedPlayers;
        }

        /**
         * Main function to trigger comparison and visualization
         */
        function comparePlayers() {
            const selectedPlayers = getSelectedPlayerData();
            const resultsArea = document.getElementById('resultsArea');
            
            // Check for valid players before drawing charts
            if (selectedPlayers.length === 0) {
                if (resultsArea) {
                    resultsArea.innerHTML = `
                        <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-lg" role="alert">
                            <p class="font-bold">No Players Selected</p>
                            <p>Please enter valid player names from the list (e.g., L. Messi, V. van Dijk, T. Kroos) to run the comparison.</p>
                            <p class="mt-2 text-xs">Available players: ${PLAYER_DATA.map(p => p.name).join(', ')}</p>
                        </div>
                    `;
                }
                // Clear any existing charts if no players are selected
                if (scatterChartInstance) scatterChartInstance.destroy();
                if (radarChartInstance) radarChartInstance.destroy();
                updateDataTable(selectedPlayers);
                return;
            }

            // Draw all visualizations
            drawScatterPlot(selectedPlayers);
            drawRadarChart(selectedPlayers.slice(0, 2)); // Only compare the first two for radar
            updateDataTable(selectedPlayers);
        }

        // --- III. Visualization (Scatter Plot) ---

        function drawScatterPlot(players) {
            const chartElement = document.getElementById('scatterChart');
            
            if (!chartElement) {
                console.error("Canvas element 'scatterChart' not found.");
                return;
            }

            const ctx = chartElement.getContext('2d');

            if (scatterChartInstance) {
                scatterChartInstance.destroy();
            }

            const dataPoints = players.map(p => ({
                x: p.Attack_Index,
                y: p.Defense_Index,
                label: p.name
            }));
            
            scatterChartInstance = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Player Indices',
                        data: dataPoints,
                        backgroundColor: 'rgba(239, 68, 68, 0.8)', // Red
                        pointRadius: 8,
                        pointHoverRadius: 10,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            min: 0,
                            max: 1.0,
                            title: { display: true, text: 'Attack Index' },
                            grid: { color: 'rgba(200, 200, 200, 0.5)' }
                        },
                        y: {
                            min: 0,
                            max: 1.0,
                            title: { display: true, text: 'Defence Index' },
                            grid: { color: 'rgba(200, 200, 200, 0.5)' }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const point = context.raw;
                                    return `${point.label}: A: ${point.x.toFixed(3)}, D: ${point.y.toFixed(3)}`;
                                }
                            }
                        }
                    }
                },
                plugins: [{
                    id: 'customScatterLabels',
                    afterDatasetsDraw(chart, args, options) {
                        const { ctx, data, scales: { x, y } } = chart;
                        ctx.save();
                        data.datasets[0].data.forEach((point, index) => {
                            const player = players[index];
                            const x_pos = x.getPixelForValue(point.x);
                            const y_pos = y.getPixelForValue(point.y);

                            ctx.font = 'bold 12px Inter, sans-serif';
                            ctx.fillStyle = '#1f2937'; // Dark gray text
                            ctx.textAlign = 'left';
                            ctx.fillText(player.name, x_pos + 10, y_pos + 4);
                        });
                        ctx.restore();
                    }
                }]
            });
        }

        // --- IV. Enhancement (Radar Chart) ---

        function drawRadarChart(players) {
            const chartElement = document.getElementById('radarChart');

            if (!chartElement) {
                console.error("Canvas element 'radarChart' not found.");
                return;
            }
            
            const ctx = chartElement.getContext('2d');

            if (radarChartInstance) {
                radarChartInstance.destroy();
            }

            // Radar Chart Labels are now ALL the features used in the model
            const radarLabels = ALL_FEATURES.map(s => {
                // Capitalize and replace underscore for display
                return s.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
            });

            const datasets = players.map((p, index) => {
                const color = index === 0 ? 'rgba(59, 130, 246, 0.8)' : 'rgba(239, 68, 68, 0.8)'; // Blue vs Red
                
                // Get the raw stat values based on the ALL_FEATURES list order
                const data = ALL_FEATURES.map(feature => p[feature] || 50); 

                return {
                    label: p.name,
                    data: data,
                    backgroundColor: color.replace('0.8', '0.2'), // Light fill
                    borderColor: color.replace('0.8', '1.0'), // Solid border
                    pointBackgroundColor: color.replace('0.8', '1.0'),
                    borderWidth: 2,
                };
            });

            radarChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: radarLabels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: {
                        line: { borderWidth: 3 }
                    },
                    scales: {
                        r: {
                            angleLines: { display: false },
                            suggestedMin: 0, 
                            suggestedMax: 100, // Stats are raw 0-100 values
                            pointLabels: { font: { size: 12 } },
                            grid: { color: 'rgba(200, 200, 200, 0.5)' },
                            ticks: { display: false }
                        }
                    },
                    plugins: {
                        legend: { position: 'top' },
                        title: { display: true, text: players.length > 1 ? `Raw Stat Comparison: ${players[0].name} vs ${players[1].name}` : 'Raw Stat Profile' }
                    }
                }
            });
        }

        // --- Data Table Update ---

        function updateDataTable(players) {
            const tableBody = document.getElementById('tableBody');
            if (!tableBody) return; 

            tableBody.innerHTML = ''; // Clear previous data

            players.forEach(player => {
                const row = tableBody.insertRow();
                row.className = 'hover:bg-gray-100 transition duration-150';

                // Name
                let cell = row.insertCell();
                cell.className = 'px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900';
                cell.textContent = player.name;

                // Attack Index
                cell = row.insertCell();
                cell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-700';
                cell.textContent = player.Attack_Index.toFixed(3);

                // Defence Index
                cell = row.insertCell();
                cell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-700';
                cell.textContent = player.Defense_Index.toFixed(3);
            });
        }

        // Run initial comparison when the page loads
        document.addEventListener('DOMContentLoaded', comparePlayers);

    </script>
</body>
</html>
